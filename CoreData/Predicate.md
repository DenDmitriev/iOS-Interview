# Синтаксис Predicate 
Определение логических условий для ограничения поиска выборки или для фильтрации в память.


## Основы
Парсер строк Predicate не чувствителен к пробелам, не чувствителен к регистру по ключевым словам и поддерживает вложенные выражения в скобках. Парсер не выполняет проверку семантического типа.

Переменные обозначаются символом доллара ($) (например, $VARIABLE_NAME). Вопросительный знак (?) символ не является допустимым маркером парсера.

Строка формата поддерживает спецификаторы формата в стиле, такие как %x (см. [Форматирование строковых объектов](https://developer.apple.com/library/archive/documentation/Cocoa/Conceptual/Strings/Articles/FormatStrings.html#//apple_ref/doc/uid/20000943)). 
Два важных спецификатора формата: %@ и %K. `NSPredicate(format:arguments:)`
- `%@` является подстановкой `arguments` для значения объекта - часто строки, числа или даты.
```swift
let name = "Adam"
let predicate = NSPredicate(format: "name == %@", name)
// Строка формата предиката в этом случае вычисляется как name == "Adam"
```

- `%K` является заменой `arguments` для ключевого пути.
```swift
let attributeName = "name"
let attributeValue = "Adam"
let predicate = NSPredicate(format: "%K like %@", attributeName, attributeValue)
// Строка формата предиката в этом случае вычисляется как firstName like "Adam"
```


## Операторы сравнения:
- `=,==` Выражение слева руки равно выражению справа.
- `>=,=>` Выражение слева больше или равно выражению справа.
- `<=,=<` Выражение слева меньше или равно выражению справа.
- `>` Выражение слева больше, чем выражение справа.
- `<` Выражение слева меньше, чем выражение справа.
- `!=,<>` Выражение слева не равно выражению справа.

- BETWEEN
Выражение слева находится между или равно любому из значений, указанных в правой части.
Правая сторона - это массив с двумя значениями (массив необходим для указания порядка), дающай верхнюю и нижнюю границы. Например, 1 BETWEEN { 0 , 33 } или $INPUT BETWEEN { $LOWER, $UPPER }.
Пример:
Допустим у модели есть поле `count` типа Int
Это создает предикат, который соответствует ( ( 1 <= count ) && ( count <= 10 ) ), как показано в следующем примере:
```swift
let betweenPredicate = NSPredicate(format: "count BETWEEN %@", [1, 10])
```

## Предикаты логических значений
- TRUEPREDICATE. Предикат, который значит TRUE.
- FALSEPREDICATE. Предикат, который значит FALSE.

## Составные предикаты
- `AND`, `&&`. Логический И.
- `OR`, `||`. Логический ИЛИ.
- `NOT`, `!`. Логический НЕТ.

## Сравнение строк
Сравнения строк по умолчанию чувствительны к регистру и знакам. 
> Вы можете изменить оператор, используя ключевые символы c и d в квадратных скобках, чтобы указать нечувствительность к регистру и диакритическим знакам соответственно, например firstName BEGINSWITH[cd] $FIRST_NAME.

- `BEGINSWITH` Выражение слева начинается с выражения справа.
- `CONTAINS` Выражение слева содержит выражение справа.
- `ENDSWITH` Выражение слева заканчивается выражением справа.
- `LIKE` Левое выражение равно правому выражению: `?` и `*` разрешены в качестве подстановочных знаков, где `?` соответствует `1` символу, а `*` соответствует 0 или более символам.
- `MATCHES` Выражение слева равно выражению справа с использованием сравнения в стиле [regex](http://icu.sourceforge.net/userguide/regexp.html).
- `UTI-CONFORMS-TO` [Подробнее](https://developer.apple.com/library/archive/documentation/Cocoa/Conceptual/Predicates/Articles/pSyntax.html)
- `UTI-EQUALS` [Подробнее](https://developer.apple.com/library/archive/documentation/Cocoa/Conceptual/Predicates/Articles/pSyntax.html)

## Совокупные операции
- `ANY`, `SOME` Указывает любой из элементов в следующем выражении. Например, `ANY children.age < 18`.
- `ALL` Указывает все элементы в следующем выражении. Например, `ALL children.age < 18`.
- `NONE` Не указывает ни один из элементов в следующем выражении. Например, `NONE children.age < 18`. Это логически эквивалентно NOT (ANY ...)
- `IN` Эквивалентно операции SQL IN, левая сторона должна появиться в коллекции, указанной правой стороной.
Вы можете создать предикат IN, как показано в следующем примере:
```swift
let names = ["Ben", "Melissa", "Nick"]
let inPredicate = NSPredicate(format: "name IN %@", names)
```
- `array[index]` Указывает элемент по указанному индексу в array массива.
- `array[FIRST]` Определяет первый элемент в array массива.
- `array[LAST]` Указывает последний элемент в array.
- `array[SIZE]` Определяет размер array массива.

## Литеральные
Одинарные и двойные кавычки дают один и тот же результат, но не замещают друг друга. Например, "abc" и 'abc' идентичны, тогда как "a'b'c" эквивалентно объединению a, 'b', c, разделенных пробелами.

- `FALSE`, `NO` Логическая ложь.
- `TRUE`, `YES` Логическая правда.
- `NULL`, `NIL ` Нульное значение.
- `SELF` Представляет оцениваемый объект.
- "text", 'text' Строка символов.
- Текстовый массив, разделенный запятыми. Например, { 'comma', 'separated', 'literal', 'array' }.
- Стандартные целочисленные и фиксированные обозначения. Например, 1, 27, 2.71828, 19.75.
- Числа с плавающей запяткой с экспоненцией. Например, 9.2e-5.
- 0x. Префикс используется для обозначения шестнадцатеричной последовательности цифр.
- 0o. Префикс используется для обозначения восьмиричной последовательности цифр.
- 0b. Префикс используется для обозначения двоичной последовательности цифр.

## Зарезервированные Слова
Следующие слова зарезервированы:
AND, OR, IN, NOT, ALL, ANY, SOME, NONE, LIKE, CASEINSENSITIVE, CI, MATCHES, CONTAINS, BEGINSWITH, ENDSWITH, BETWEEN, NULL, NIL, SELF, TRUE, YES, FALSE, NO, FIRST, LAST, SIZE, ANYKEY, SUBQUERY, FETCH, CAST, TRUEPREDICATE, FALSEPREDICATE, UTI-CONFORMS-TO, UTI-EQUALS,

## Источники
- [Predicate Format String Syntax](https://developer.apple.com/library/archive/documentation/Cocoa/Conceptual/Predicates/Articles/pSyntax.html)
