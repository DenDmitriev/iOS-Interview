# `setNeedsLayout()` vs `layoutIfNeeded()` vs `layoutSubviews()`
При запуске приложения iOS, UIApplication в iOS запускает цикл оброботки событий Main Run Loop, который запускается в главном потоке (main thread). Цикл Main Run Loop  обрабатывает события (например, прикосновения пользователя) и обрабатывает обновления интерфейсов на основе представления. По мере возникновения событий, таких как касание, обновление местоположения, движение, цикл Main Run Loop находит подходящий обработчик для событий объект `UIResponder`, вызывая соответствующие методы, которые вызывают другие методы и так далее. В какой-то момент все события будут обработаны, и контроль вернется в цикл запуска. Давайте пометим эту точку, где управление возвращается в цикл запуска, как цикл обновления.

Пока события обрабатываются, и некоторые изменения запрашиваются в представлении, эти изменения не обновляются немедленно. Вместо этого система ждет завершения существующего процесса и следующего цикла перерисовки. Существует периодический интервал между обработкой событий и обработкой обновления макета пользовательского интерфейса. Вот почему нам нужно правильно понять три вышеуказанных метода.

## `setNeedsLayout()`
> Метод setNeedsLayout для UIView сообщает системе, что вы хотите, чтобы она разметила и перерисовала это представление и все его подпредставления, когда придет время следующего цикла обновления. Это асинхронное действие, поскольку метод завершается и возвращает результат немедленно, но момент перерисовки макета происходят только через некоторое время, и вы не знаете, когда будет этот цикл обновления.

Apple doc говорит: Вызовите этот метод на главном потоке вашего приложения, если вы хотите изменить макет представления. Этот метод записывает запрос и немедленно возвращает его. Поскольку этот метод не заставляет немедленно обновить представление, а вместо этого ждет следующего цикла обновления, вы можете использовать его для аннулирования макета нескольких представлений, прежде чем любой из этих представлений будет обновлен. Это поведение позволяет объединить все обновления макета в один цикл обновления, что обычно лучше для производительности.

## `layoutIfNeeded()`
> A вот метод layoutIfNeeded - это синхронный вызов, который сообщает системе, что вы хотите немедленно обновить представление, не дожидаясь цикла обновления. Когда вызов этого метода завершен, макет уже был скорректирован и нарисован на основе всех изменений, которые были отмечены до вызова метода.

## `layoutSubviews()`
Именно здесь происходит "магия": `layoutSubviews()` просматривает все ограничения, которые влияют на размер представления, и преобразует их в реальные кадры.
Реализация по умолчанию использует любые ограничения, которые вы установили для определения размера и положения представления. 

Большинство макетов могут быть реализованы с помощью автоматического макета, и вы всегда должны стараться это сделать. Даже если макет, который вы имеете в виду, немного сложнее, вероятно, есть решение для автоматической компоновки. Тем не менее, некоторые действительно причудливые макеты могут потребовать некоторой настройки, и если вам нужно это сделать, правильное место находится внутри layoutSubviews(), после вызова суперреализации:
```swift
    override func layoutSubviews() {
        super.layoutSubviews()
        // your code
    }
```
На этом этапе в переопределении метода вы можете смело предположить, что
- Сама рамка `frame` вида установлена верно.
- Рамка `frame` непосредственных подпредставлений представления установлена верно.
Так что, если вам нужно выполнить какие-либо вычисления в зависимости от размера представления, это место для этого.

**Важно**: Вы не должны вызывать метод `layoutSubviews()` напрямую. Если вы хотите принудительно обновить макет, вызовите метод `setNeedsLayout()`, чтобы сделать это до следующего обновления чертежа. Если вы хотите немедленно обновить макет своих представлений, вызовите метод `layoutIfNeeded()`.


| Метод `UIView` | Зачем? |
| - | - |
| `setNeedsLayout()` | обновит в следуйщий цикл обновления |
| `layoutIfNeeded()` | обновит немедленно |
| `layoutSubviews()` | не вызывать |

Источники:
- [iOS swift — setNeedsLayout vs layoutIfNeeded vs layoutSubviews()](https://abhimuralidharan.medium.com/ios-swift-setneedslayout-vs-layoutifneeded-vs-layoutsubviews-5a2b486da31c)
- [The Auto Layout Comprehendium](https://medium.com/@PhiJay/the-auto-layout-comprehendium-%EF%B8%8F-6d7e2105bf70)
